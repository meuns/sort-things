# Configure build
EXE_SUFFIX=
ifeq ($(BUILD), DEBUG)
	BUILD_DIR_PATH=./.debug
else ifeq ($(BUILD), PROFILE)
	BUILD_DIR_PATH=./.profile
else
	BUILD_DIR_PATH=./.release
endif

ifeq ($(COMPILER), GCC)
	BUILD_DIR_PATH:=$(BUILD_DIR_PATH)_gcc
	EXE_SUFFIX:=$(EXE_SUFFIX)_gcc
else
	BUILD_DIR_PATH:=$(BUILD_DIR_PATH)_clang
	EXE_SUFFIX:=$(EXE_SUFFIX)_clang
	ifeq ($(LTO), 1)
		BUILD_DIR_PATH:=$(BUILD_DIR_PATH)_lto
		EXE_SUFFIX:=$(EXE_SUFFIX)_lto
	endif
endif

ifeq ($(BUILD), DEBUG)
	EXE_SUFFIX:=$(EXE_SUFFIX)_d
else ifeq ($(BUILD), PROFILE)
	EXE_SUFFIX:=$(EXE_SUFFIX)_p
else
	EXE_SUFFIX:=$(EXE_SUFFIX)_r
endif

ifeq ($(COMPILER), GCC)
	CC=gcc
	CXX=gcc	
	CFLAGS_COMMON=-std=c11 -D_XOPEN_SOURCE=600 -Wall -Wextra -Wpedantic -Wformat -Wbool-compare -Wcast-qual -Wconversion -Winit-self -Wrestrict -Wunused -Werror
	CXXFLAGS_COMMON=-std=c++14 -D_XOPEN_SOURCE=600 -Wall -Wextra -Wpedantic -Wformat -Wbool-compare -Wcast-qual -Wconversion -Winit-self -Wrestrict -Wunused -Werror
	LDFLAGS=
else
	CC=clang
	CXX=clang
	CFLAGS_COMMON=-std=c11 -D_XOPEN_SOURCE=600 -Weverything -Werror -Wno-gnu-empty-initializer -Wno-zero-length-array -Wno-vla -Wno-missing-prototypes
	CXXFLAGS_COMMON=-std=c++14 -D_XOPEN_SOURCE=600 -Weverything -Werror -Wno-gnu-empty-initializer -Wno-zero-length-array -Wno-vla -Wno-missing-prototypes
	LDFLAGS=
endif

ifeq ($(BUILD), DEBUG)
	CFLAGS=$(CFLAGS_COMMON) -g -O0
	CXXFLAGS=$(CXXFLAGS_COMMON) -g -O0
else ifeq ($(BUILD), PROFILE)
	CFLAGS=$(CFLAGS_COMMON) -g -D NDEBUG -O2
	CXXFLAGS=$(CXXFLAGS_COMMON) -g -D NDEBUG -O2
else
	CFLAGS=$(CFLAGS_COMMON) -D NDEBUG -O2
	CXXFLAGS=$(CXXFLAGS_COMMON) -D NDEBUG -O2
	ifeq ($(COMPILER), CLANG)
		ifeq ($(LTO), 1)
			CFLAGS+=-flto
			CXXFLAGS+=-flto
			LDFLAGS+=-flto -fuse-ld=gold -Wl
		endif
	endif
endif
